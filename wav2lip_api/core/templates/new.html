<!DOCTYPE html>
<html>
<head><title>From Text to Video</title></head>
<body>
  <h2>Generate Avtar Video from Text</h2>
  <form action="/api/generate/from-text/" method="POST">
    <label>Text: <input type="text" name="text" required></label><br><br>
    <label>Speaker ID: <input type="text" name="speaker_id" required></label><br><br>
    <button type="submit">Generate</button>
  </form>
</body>
</html>




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Input to Avatar Video</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto; }
        h2 { text-align: center; color: #333; margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="text"] { width: calc(100% - 22px); padding: 10px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #status { margin-top: 20px; padding: 10px; border-radius: 4px; background-color: #e9ecef; color: #333; text-align: center; }
        #videoOutput { margin-top: 30px; text-align: center; }
        #videoOutput video { max-width: 100%; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        #output { /* Styles for the text output div */
            padding: 10px;
            margin-top: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 80px;
            background-color: #fff;
            overflow-y: auto;
        }
        select {
            padding: 8px;
            margin-bottom: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Speak to Your Avatar</h2>

        <label for="speakerId">Speaker ID:</label>
        <input type="text" id="speakerId" value="default" required><br><br>

        <label for="languageSelect">Select Language for Speech Recognition:</label>
        <select id="languageSelect" onchange="onLanguageChange()">
            <option value="en-US">English (US)</option>
            <option value="en-IN">English (India)</option>
            <option value="hi-IN">Hindi (India)</option>
            </select><br><br>

        <button id="startButton">Start Voice Input</button>
        <button id="stopButton" disabled>Stop Recording</button>
        <button id="clearButton">Clear Text</button>
        <button id="generateButton" disabled>Generate Video</button>

        <div id="output" contentEditable="true" placeholder="Speak here..."></div>
        <div id="status">Ready. Click 'Start Voice Input'</div>

        <div id="videoOutput">
            </div>
    </div>

    <script>
        // Wrap the entire script in a DOMContentLoaded listener to ensure all HTML elements are loaded
        document.addEventListener('DOMContentLoaded', (event) => {
            // Reference to HTML elements
            const speakerIdInput = document.getElementById('speakerId');
            const languageSelect = document.getElementById('languageSelect');
            const startButton = document.getElementById('startButton');
            const stopButton = document.getElementById('stopButton');
            const clearButton = document.getElementById('clearButton');
            const generateButton = document.getElementById('generateButton');
            const outputDiv = document.getElementById('output');
            const statusDiv = document.getElementById('status');
            const videoOutputDiv = document.getElementById('videoOutput');

            // Initialize SpeechRecognition
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                statusDiv.textContent = "Speech Recognition not supported in this browser. Please use Chrome, Edge, or Firefox.";
                startButton.disabled = true;
                return;
            }
            const recognition = new SpeechRecognition();

            // Configure recognition
            recognition.continuous = true; // Keep listening even if pauses
            recognition.interimResults = true; // Show results as they are being spoken
            recognition.lang = languageSelect.value; // Set initial language

            let finalTranscript = ''; // Stores the final, confirmed transcript

            recognition.onstart = () => {
                statusDiv.textContent = 'Listening...';
                startButton.disabled = true;
                stopButton.disabled = false;
                generateButton.disabled = true;
                outputDiv.textContent = ''; // Clear previous text on new start
                finalTranscript = '';
                videoOutputDiv.innerHTML = ''; // Clear previous video
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                outputDiv.textContent = finalTranscript + interimTranscript; // Show both
            };

            recognition.onerror = (event) => {
                statusDiv.textContent = `Speech recognition error: ${event.error}`;
                console.error('Speech recognition error:', event.error);
                startButton.disabled = false;
                stopButton.disabled = true;
                generateButton.disabled = true;
            };

            recognition.onend = () => {
                statusDiv.textContent = 'Recording stopped. Review text and click \'Generate Video\'.';
                startButton.disabled = false;
                stopButton.disabled = true;
                generateButton.disabled = false; // Enable generate button after recording ends
                // Ensure final transcript is in outputDiv if continuous was true
                outputDiv.textContent = finalTranscript.trim();
            };

            // Event Handlers
            startButton.onclick = () => {
                finalTranscript = ''; // Reset for a new session
                outputDiv.textContent = ''; // Clear display
                recognition.start();
            };

            stopButton.onclick = () => {
                recognition.stop();
            };

            clearButton.onclick = () => {
                outputDiv.textContent = '';
                finalTranscript = '';
                statusDiv.textContent = 'Text cleared.';
                generateButton.disabled = true; // Disable generate if text is cleared
            };

            // Define onLanguageChange inside DOMContentLoaded
            function onLanguageChange() {
                recognition.lang = languageSelect.value;
                statusDiv.textContent = `Language changed to ${languageSelect.options[languageSelect.selectedIndex].text}`;
            }

            // Make onLanguageChange accessible globally for the HTML onchange attribute
            window.onLanguageChange = onLanguageChange;

            generateButton.onclick = async () => {
                const textToSend = outputDiv.textContent.trim();
                const speakerId = speakerIdInput.value.trim();

                if (!textToSend) {
                    statusDiv.textContent = 'No text to generate video from. Please speak or type.';
                    return;
                }
                if (!speakerId) {
                    statusDiv.textContent = 'Please enter a Speaker ID.';
                    return;
                }

                statusDiv.textContent = 'Sending text and generating video... This may take a moment.';
                generateButton.disabled = true;
                startButton.disabled = true; // Disable start during generation

                // *** CRITICAL FIX: Sending data as application/x-www-form-urlencoded ***
                const urlEncodedData = new URLSearchParams();
                urlEncodedData.append('text', textToSend);
                urlEncodedData.append('speaker_id', speakerId);

                try {
                    const response = await fetch('/api/generate/from-text/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded' // Explicitly setting header
                        },
                        body: urlEncodedData.toString() // Sending URL-encoded string
                    });

                    if (response.ok) {
                        // Attempt to get the response as a blob (video file)
                        const videoBlob = await response.blob();
                        if (videoBlob.type.startsWith('video/')) {
                            const videoUrl = URL.createObjectURL(videoBlob);
                            videoOutputDiv.innerHTML = `<video controls autoplay src="${videoUrl}"></video>`;
                            statusDiv.textContent = 'Video generated successfully!';
                        } else {
                            // If it's not a video, it might be an error message as plain text/json
                            const errorResponseText = await videoBlob.text();
                            statusDiv.textContent = `Error: Server did not return a video. Response: ${errorResponseText.substring(0, 100)}...`; // Show first 100 chars
                            console.error('Server response was not video:', errorResponseText);
                        }
                    } else {
                        // Handle non-OK responses (e.g., 400, 500)
                        // Try to parse JSON error first, then fall back to text if not JSON
                        try {
                            const errorData = await response.json();
                            statusDiv.textContent = `Error generating video: ${errorData.error || response.statusText}`;
                            console.error('API Error (JSON):', errorData);
                        } catch (jsonParseError) {
                            const errorText = await response.text();
                            statusDiv.textContent = `Error generating video: ${response.status} ${response.statusText} - ${errorText.substring(0, 100)}...`;
                            console.error('API Error (Plain Text):', errorText);
                        }
                    }
                } catch (error) {
                    statusDiv.textContent = `Network or other error: ${error.message}`;
                    console.error('Fetch error:', error);
                } finally {
                    startButton.disabled = false;
                    generateButton.disabled = true; // Disable generate until new input
                }
            };
        }); // End of DOMContentLoaded listener
    </script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
  <title>LipSync Generator</title>
</head>
<body>
  <h2>Generate Avtar Video</h2>
  <form id="lipSyncForm" enctype="multipart/form-data">
    <label>Upload Video: <input type="file" name="video" required></label><br><br>
    <label>Text: <input type="text" name="text" required></label><br><br>
    <label>Speaker ID (optional): <input type="text" name="speaker_id"></label><br><br>
    <button type="submit">Generate</button>
  </form>

  <div id="status"></div>
  <div id="videoContainer"></div>

  <script>
    const form = document.getElementById('lipSyncForm');
    const statusDiv = document.getElementById('status');
    const videoContainer = document.getElementById('videoContainer');

    form.addEventListener('submit', async (event) => {
      event.preventDefault(); // Prevent the form from submitting normally

      const formData = new FormData(form);
      const csrftoken = document.cookie.split('; ').find(row => row.startsWith('csrftoken='))?.split('=')[1];

      statusDiv.textContent = 'Generating video, please wait...';
      videoContainer.innerHTML = '';

      try {
        const response = await fetch('/api/generate/', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': csrftoken
          }
        });

        if (response.ok) {
          const videoBlob = await response.blob();
          const videoUrl = URL.createObjectURL(videoBlob);
          
          statusDiv.textContent = 'Video generated successfully!';
          videoContainer.innerHTML = `
            <video width="640" height="360" controls>
              <source src="${videoUrl}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <br>
            <a href="${videoUrl}" download="generated_video.mp4">Download Video</a>
          `;
        } else {
          const errorText = await response.text();
          statusDiv.textContent = `Error: ${errorText || response.statusText}`;
        }
      } catch (error) {
        statusDiv.textContent = `An unexpected error occurred: ${error.message}`;
        console.error('Fetch error:', error);
      }
    });
  </script>
</body>
</html>



<!DOCTYPE html>
<html>
<head><title>Text Answer</title></head>
<body>
  <h2>Ask a Question</h2>
  <form action="/api/generate/text-only/" method="POST">
    <label>Your Question: <input type="text" name="text" required></label><br><br>
    <button type="submit">Get Answer</button>
  </form>
</body>
</html>